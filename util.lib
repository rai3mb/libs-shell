#!/bin/bash
#By: Raimundo Portela <rai3mb@gmail.com>

_getParam() {
	X="$1"
	while shift
	do
		if [ "$1" = "$X" ]; then
			[ "$2" ] && echo "$2" && return 0 || return 1
		fi
	done
	return 1
}

_getDate() {
	date +'%Y%m%d'
}

_setInExec() {
	local P=$(_getPID)
	[ ${P:-0} -eq 0 ] && echo "$$|$(date +%s)" > /var/run/scripts/${0##/}.pid && return 0
	echo "${0##/} in execution with pid |$P" && exit 1
}

_getPID() {
	[ ! -f /var/run/scripts/${0##/}.pid ] && echo 0
        local PID=$(cat /var/run/scripts/${0##/}.pid | cut -d'|' -f1) # pega o pid registrado para o processo
	echo "$(ps -p ${PID:-xx} -o cmd= 2>/dev/null)" | fgrep -q "${0##/}" && echo $PID || echo 0
}

_checkInExec() {
	[ $(_getPID) -eq 0 ] && return 1 || return 0
}
